/*<FH+>************************************************************************/
/*                                                                            */
/* 版权所有: Copyright (C) 7号电单车. 2017. All rights reserved.              */
/*                                                                            */
/* 文件名称: pub_fsm.h                                                        */
/* 内容摘要: 一种有限状态机实现的头文件                                       */
/* 其它说明: 无                                                               */
/* 当前版本: v0.9                                                             */
/* 作    者: maag                                                             */
/* 完成日期: 2017-12-1                                                        */
/* 修改记录:                                                                  */
/*     修改日期          版本号      修改人          修改内容                 */
/* -------------------------------------------------------------------------- */
/*     2017-12-1         v0.9        maag            创建文件                 */
/*<FH->************************************************************************/
#ifndef PUB_FSM_H
#define PUB_FSM_H


/******************************************************************************/
/*               #include（依次为标准库头文件、非标准库头文件）               */
/******************************************************************************/


/******************************************************************************/
/*                              其他条件编译选项                              */
/******************************************************************************/
#ifdef __cplusplus
extern "C" {
#endif


/******************************************************************************/
/*                                  常量定义                                  */
/******************************************************************************/
/******************************************************************************/
/* 未知操作类型定义                                                           */
/******************************************************************************/
#define FSM_OPER_TYPE_UNKNOWN           (U16)0xFFFF

/******************************************************************************/
/* 通用状态机状态定义                                                         */
/******************************************************************************/
#define FSM_IDLE                        (U32)0x00000001
#define FSM_INIT                        (U32)0x00000002
#define FSM_WORK                        (U32)0x00000004
#define FSM_RESET                       (U32)0x00000008

/******************************************************************************/
/* 状态机特殊状态定义                                                         */
/******************************************************************************/
#define UNK                             ((struct t_fsm_desc *)0xFFFFFFFF)
#define SAME                            ((struct t_fsm_desc *)0x00000000)

/******************************************************************************/
/* 定义状态机的一个状态；实质是定义了一个数组                                 */
/******************************************************************************/
#define DFSM(NAME)                      T_FSM_DESC NAME[] = {
#define OFSM(TYPE, FUNC, NEXT)          {(TYPE), (FUNC), (NEXT)},
#define FFSM(ERR, NEXT)                 {FSM_OPER_TYPE_UNKNOWN, (ERR), (NEXT)}};

/******************************************************************************/
/* 执行状态机的宏定义                                                         */
/******************************************************************************/
#define FSM_EXECUTE(MSG, FSM)           PUB_FsmExecute(MSG, FSM)
#define FSM_SET_NEXT_STATE(CUR, NEXT)   PUB_FsmSetNextState(CUR, NEXT)


/******************************************************************************/
/*                                 全局宏定义                                 */
/******************************************************************************/


/******************************************************************************/
/*                              全局数据类型定义                              */
/******************************************************************************/
/******************************************************************************/
/* 指向状态处理函数的指针                                                     */
/******************************************************************************/
typedef void (*FSM_PROC_FUNC)(void *);

/*<STRUCT+>********************************************************************/
/* 结构: T_FSM_DESC                                                           */
/* 注释: 状态机描述符                                                         */
/*<STRUCT->********************************************************************/
typedef struct t_fsm_desc
{
    U16                operType;
    FSM_PROC_FUNC      pfFunc;
    struct t_fsm_desc *nextState;

} T_FSM_DESC;


/******************************************************************************/
/*                                全局变量声明                                */
/******************************************************************************/


/******************************************************************************/
/*                                 全局函数原型                               */
/******************************************************************************/
void PUB_FsmExecute(void *ptMsg, T_FSM_DESC **ptCurStat);
void PUB_FsmSetNextState(T_FSM_DESC **ptCurState, T_FSM_DESC *ptNextState);


#ifdef __cplusplus
    }
#endif

#endif


